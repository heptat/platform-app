# helpers.rb
require 'net/http'
require 'json'
require 'logger'

helpers do

  def verify_token(token_value)
    # TODO the app-key really should be a one-time signature generated by a
    # private key so that the matching public key on auth can verify it
    app_key = "5555"

    url = URI.parse("http://auth.platform.local/tokens/#{token_value}?app-key=#{app_key}")
    req = Net::HTTP::Get.new(url.to_s)
    res = Net::HTTP.start(url.host, url.port) {|http|
      http.request(req)
    }
    JSON.parse(res.body)
  end

end

